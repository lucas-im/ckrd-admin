"use strict";
//global.patchPackageIsDebug = true // debug
var __importDefault = (this && this.__importDefault) || function (mod) {
    return (mod && mod.__esModule) ? mod : { "default": mod };
};
Object.defineProperty(exports, "__esModule", { value: true });
const detectPackageManager_1 = require("./detectPackageManager"); // typescript
// FIXME test takes too long: 5 seconds
/*
import { join } from "./path"
import { normalize } from "path"
*/
//import { getPackageDetailsFromPatchFilename } from "./PackageDetails"
//import { existsSync } from "fs"
// https://www.emgoto.com/nodejs-mock-fs/
const mock_fs_1 = __importDefault(require("mock-fs"));
//const appPath = normalize(join(__dirname, "../"))
const packageJsonContent = JSON.stringify({
    name: "test",
    version: "1.0.0",
});
function commonFiles() {
    // workaround for deep-clone of object
    const files = {
        workspaces: {
            workspace: {
                projects: {
                    project: {
                        "package.json": packageJsonContent,
                    }
                }
            }
        }
    };
    return files;
}
// workaround
// https://github.com/tschaub/mock-fs/issues/234
console.log('(workaround for mock-fs: fix console)');
describe('detectPackageManager', () => {
    let projectPath = "workspaces/workspace/projects/project";
    //beforeAll(() => {
    //  ...
    //})
    it("detects npm from lockfile in cwd", () => {
        const files = commonFiles();
        files.workspaces.workspace.projects.project["package-lock.json"] = ""; // empty file is ok for now
        (0, mock_fs_1.default)(files);
        expect((0, detectPackageManager_1.detectPackageManager)(projectPath, null)).toBe("npm");
    });
    it("detects npm from lockfile in parent dir", () => {
        const files = commonFiles();
        files.workspaces.workspace.projects["package-lock.json"] = ""; // empty file is ok for now
        (0, mock_fs_1.default)(files);
        expect((0, detectPackageManager_1.detectPackageManager)(projectPath, null)).toBe("npm");
    });
    it("detects npm from lockfile in parent dir 2", () => {
        const files = commonFiles();
        files.workspaces.workspace["package-lock.json"] = ""; // empty file is ok for now
        (0, mock_fs_1.default)(files);
        expect((0, detectPackageManager_1.detectPackageManager)(projectPath, null)).toBe("npm");
    });
    it("detects yarn from lockfile in cwd", () => {
        const files = commonFiles();
        files.workspaces.workspace.projects.project["yarn.lock"] = ""; // empty file is ok for now
        (0, mock_fs_1.default)(files);
        expect((0, detectPackageManager_1.detectPackageManager)(projectPath, null)).toBe("yarn");
    });
    it("detects yarn from lockfile in parent dir", () => {
        const files = commonFiles();
        files.workspaces.workspace.projects["yarn.lock"] = ""; // empty file is ok for now
        (0, mock_fs_1.default)(files);
        expect((0, detectPackageManager_1.detectPackageManager)(projectPath, null)).toBe("yarn");
    });
    it("detects yarn from lockfile in parent dir 2", () => {
        const files = commonFiles();
        files.workspaces.workspace["yarn.lock"] = ""; // empty file is ok for now
        (0, mock_fs_1.default)(files);
        expect((0, detectPackageManager_1.detectPackageManager)(projectPath, null)).toBe("yarn");
    });
    it("detects pnpm from lockfile in cwd", () => {
        const files = commonFiles();
        files.workspaces.workspace.projects.project["pnpm-lock.yaml"] = ""; // empty file is ok for now
        (0, mock_fs_1.default)(files);
        expect((0, detectPackageManager_1.detectPackageManager)(projectPath, null)).toBe("pnpm");
    });
    it("detects pnpm from lockfile in parent dir", () => {
        const files = commonFiles();
        files.workspaces.workspace.projects["pnpm-lock.yaml"] = ""; // empty file is ok for now
        (0, mock_fs_1.default)(files);
        expect((0, detectPackageManager_1.detectPackageManager)(projectPath, null)).toBe("pnpm");
    });
    it("detects pnpm from lockfile in parent dir 2", () => {
        const files = commonFiles();
        files.workspaces.workspace["pnpm-lock.yaml"] = ""; // empty file is ok for now
        (0, mock_fs_1.default)(files);
        expect((0, detectPackageManager_1.detectPackageManager)(projectPath, null)).toBe("pnpm");
    });
    // FIXME
    /*
    it("falls back to npm if no lockfile was found", () => {
      const files = commonFiles()
      mockFs(files)
      expect(detectPackageManager(projectPath, null)).toBe("npm")
      mockFs.restore()
    })
    */
    // TODO test overridePackageManager != null
    afterEach(() => {
        mock_fs_1.default.restore();
    });
    //afterAll(() => {
    //  mockFs.restore()
    //})
});
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiZGV0ZWN0UGFja2FnZU1hbmFnZXIudGVzdC5qcyIsInNvdXJjZVJvb3QiOiIiLCJzb3VyY2VzIjpbIi4uL3NyYy9kZXRlY3RQYWNrYWdlTWFuYWdlci50ZXN0LnRzIl0sIm5hbWVzIjpbXSwibWFwcGluZ3MiOiI7QUFBQSw0Q0FBNEM7Ozs7O0FBRTVDLGlFQUE2RCxDQUFDLGFBQWE7QUFFM0UsdUNBQXVDO0FBRXZDOzs7RUFHRTtBQUNGLHVFQUF1RTtBQUN2RSxpQ0FBaUM7QUFFakMseUNBQXlDO0FBQ3pDLHNEQUE0QjtBQUU1QixtREFBbUQ7QUFFbkQsTUFBTSxrQkFBa0IsR0FBRyxJQUFJLENBQUMsU0FBUyxDQUFDO0lBQ3hDLElBQUksRUFBRSxNQUFNO0lBQ1osT0FBTyxFQUFFLE9BQU87Q0FDakIsQ0FBQyxDQUFBO0FBRUYsU0FBUyxXQUFXO0lBQ2xCLHNDQUFzQztJQUN0QyxNQUFNLEtBQUssR0FBRztRQUNaLFVBQVUsRUFBRTtZQUNWLFNBQVMsRUFBRTtnQkFDVCxRQUFRLEVBQUU7b0JBQ1IsT0FBTyxFQUFFO3dCQUNQLGNBQWMsRUFBRSxrQkFBa0I7cUJBQ25DO2lCQUNGO2FBQ0Y7U0FDRjtLQUNGLENBQUE7SUFDRCxPQUFPLEtBQUssQ0FBQTtBQUNkLENBQUM7QUFFRCxhQUFhO0FBQ2IsZ0RBQWdEO0FBQ2hELE9BQU8sQ0FBQyxHQUFHLENBQUMsdUNBQXVDLENBQUMsQ0FBQTtBQUVwRCxRQUFRLENBQUMsc0JBQXNCLEVBQUUsR0FBRyxFQUFFO0lBRXBDLElBQUksV0FBVyxHQUFHLHVDQUF1QyxDQUFBO0lBRXpELG1CQUFtQjtJQUNuQixPQUFPO0lBQ1AsSUFBSTtJQUVKLEVBQUUsQ0FBQyxrQ0FBa0MsRUFBRSxHQUFHLEVBQUU7UUFDMUMsTUFBTSxLQUFLLEdBQUcsV0FBVyxFQUFFLENBQUE7UUFDM0IsS0FBSyxDQUFDLFVBQVUsQ0FBQyxTQUFTLENBQUMsUUFBUSxDQUFDLE9BQU8sQ0FBQyxtQkFBbUIsQ0FBQyxHQUFHLEVBQUUsQ0FBQSxDQUFDLDJC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QUNwQixJQUFJO0FBQ04sQ0FBQyxDQUFDLENBQUEiLCJzb3VyY2VzQ29udGVudCI6WyIvL2dsb2JhbC5wYXRjaFBhY2thZ2VJc0RlYnVnID0gdHJ1ZSAvLyBkZWJ1Z1xuXG5pbXBvcnQgeyBkZXRlY3RQYWNrYWdlTWFuYWdlciB9IGZyb20gXCIuL2RldGVjdFBhY2thZ2VNYW5hZ2VyXCIgLy8gdHlwZXNjcmlwdFxuXG4vLyBGSVhNRSB0ZXN0IHRha2VzIHRvbyBsb25nOiA1IHNlY29uZHNcblxuLypcbmltcG9ydCB7IGpvaW4gfSBmcm9tIFwiLi9wYXRoXCJcbmltcG9ydCB7IG5vcm1hbGl6ZSB9IGZyb20gXCJwYXRoXCJcbiovXG4vL2ltcG9ydCB7IGdldFBhY2thZ2VEZXRhaWxzRnJvbVBhdGNoRmlsZW5hbWUgfSBmcm9tIFwiLi9QYWNrYWdlRGV0YWlsc1wiXG4vL2ltcG9ydCB7IGV4aXN0c1N5bmMgfSBmcm9tIFwiZnNcIlxuXG4vLyBodHRwczovL3d3dy5lbWdvdG8uY29tL25vZGVqcy1tb2NrLWZzL1xuaW1wb3J0IG1vY2tGcyBmcm9tICdtb2NrLWZzJ1xuXG4vL2NvbnN0IGFwcFBhdGggPSBub3JtYWxpemUoam9pbihfX2Rpcm5hbWUsIFwiLi4vXCIpKVxuXG5jb25zdCBwYWNrYWdlSnNvbkNvbnRlbnQgPSBKU09OLnN0cmluZ2lmeSh7XG4gIG5hbWU6IFwidGVzdFwiLFxuICB2ZXJzaW9uOiBcIjEuMC4wXCIsXG59KVxuXG5mdW5jdGlvbiBjb21tb25GaWxlcygpIHtcbiAgLy8gd29ya2Fyb3VuZCBmb3IgZGVlcC1jbG9uZSBvZiBvYmplY3RcbiAgY29uc3QgZmlsZXMgPSB7XG4gICAgd29ya3NwYWNlczoge1xuICAgICAgd29ya3NwYWNlOiB7XG4gICAgICAgIHByb2plY3RzOiB7XG4gICAgICAgICAgcHJvamVjdDoge1xuICAgICAgICAgICAgXCJwYWNrYWdlLmpzb25cIjogcGFja2FnZUpzb25Db250ZW50LFxuICAgICAgICAgIH1cbiAgICAgICAgfVxuICAgICAgfVxuICAgIH1cbiAgfVxuICByZXR1cm4gZmlsZXNcbn1cblxuLy8gd29ya2Fyb3VuZFxuLy8gaHR0cHM6Ly9naXRodWIuY29tL3RzY2hhdWIvbW9jay1mcy9pc3N1ZXMvMjM0XG5jb25zb2xlLmxvZygnKHdvcmthcm91bmQgZm9yIG1vY2stZnM6IGZpeCBjb25zb2xlKScpXG5cbmRlc2NyaWJlKCdkZXRlY3RQYWNrYWdlTWFuYWdlcicsICgpID0+IHtcblxuICBsZXQgcHJvamVjdFBhdGggPSBcIndvcmtzcGFjZXMvd29ya3NwYWNlL3Byb2plY3RzL3Byb2plY3RcIlxuXG4gIC8vYmVmb3JlQWxsKCgpID0+IHtcbiAgLy8gIC4uLlxuICAvL30pXG5cbiAgaXQoXCJkZXRlY3RzIG5wbSBmcm9tIGxvY2tmaWxlIGluIGN3ZFwiLCAoKSA9PiB7XG4gICAgY29uc3QgZmlsZXMgPSBjb21tb25GaWxlcygpXG4gICAgZmlsZXMud29ya3NwYWNlcy53b3Jrc3BhY2UucHJvamVjdHMucHJvamVjdFtcInBhY2thZ2UtbG9jay5qc29uXCJdID0gXCJcIiAvLyBlbXB0eSBmaWxlIGlzIG9rIGZvciBub3dcbiAgICBtb2NrRnMoZmlsZXMpXG4gICAgZXhwZWN0KGRldGVjdFBhY2thZ2VNYW5hZ2VyKHByb2plY3RQYXRoLCBudWxsKSkudG9CZShcIm5wbVwiKVxuICB9KVxuXG4gIGl0KFwiZGV0ZWN0cyBucG0gZnJvbSBsb2NrZmlsZSBpbiBwYXJlbnQgZGlyXCIsICgpID0+IHtcbiAgICBjb25zdCBmaWxlcyA9IGNvbW1vbkZpbGVzKClcbiAgICBmaWxlcy53b3Jrc3BhY2VzLndvcmtzcGFjZS5wcm9qZWN0c1tcInBhY2thZ2UtbG9jay5qc29uXCJdID0gXCJcIiAvLyBlbXB0eSBmaWxlIGlzIG9rIGZvciBub3dcbiAgICBtb2NrRnMoZmlsZXMpXG4gICAgZXhwZWN0KGRldGVjdFBhY2thZ2VNYW5hZ2VyKHByb2plY3RQYXRoLCBudWxsKSkudG9CZShcIm5wbVwiKVxuICB9KVxuXG4gIGl0KFwiZGV0ZWN0cyBucG0gZnJvbSBsb2NrZmlsZSBpbiBwYXJlbnQgZGlyIDJcIiwgKCkgPT4ge1xuICAgIGNvbnN0IGZpbGVzID0gY29tbW9uRmlsZXMoKVxuICAgIGZpbGVzLndvcmtzcGFjZXMud29ya3NwYWNlW1wicGFja2FnZS1sb2NrLmpzb25cIl0gPSBcIlwiIC8vIGVtcHR5IGZpbGUgaXMgb2sgZm9yIG5vd1xuICAgIG1vY2tGcyhmaWxlcylcbiAgICBleHBlY3QoZGV0ZWN0UGFja2FnZU1hbmFnZXIocHJvamVjdFBhdGgsIG51bGwpKS50b0JlKFwibnBtXCIpXG4gIH0pXG5cbiAgaXQoXCJkZXRlY3RzIHlhcm4gZnJvbSBsb2NrZmlsZSBpbiBjd2RcIiwgKCkgPT4ge1xuICAgIGNvbnN0IGZpbGVzID0gY29tbW9uRmlsZXMoKVxuICAgIGZpbGVzLndvcmtzcGFjZXMud29ya3NwYWNlLnByb2plY3RzLnByb2plY3RbXCJ5YXJuLmxvY2tcIl0gPSBcIlwiIC8vIGVtcHR5IGZpbGUgaXMgb2sgZm9yIG5vd1xuICAgIG1vY2tGcyhmaWxlcylcbiAgICBleHBlY3QoZGV0ZWN0UGFja2FnZU1hbmFnZXIocHJvamVjdFBhdGgsIG51bGwpKS50b0JlKFwieWFyblwiKVxuICB9KVxuXG4gIGl0KFwiZGV0ZWN0cyB5YXJuIGZyb20gbG9ja2ZpbGUgaW4gcGFyZW50IGRpclwiLCAoKSA9PiB7XG4gICAgY29uc3QgZmlsZXMgPSBjb21tb25GaWxlcygpXG4gICAgZmlsZXMud29ya3NwYWNlcy53b3Jrc3BhY2UucHJvamVjdHNbXCJ5YXJuLmxvY2tcIl0gPSBcIlwiIC8vIGVtcHR5IGZpbGUgaXMgb2sgZm9yIG5vd1xuICAgIG1vY2tGcyhmaWxlcylcbiAgICBleHBlY3QoZGV0ZWN0UGFja2FnZU1hbmFnZXIocHJvamVjdFBhdGgsIG51bGwpKS50b0JlKFwieWFyblwiKVxuICB9KVxuXG4gIGl0KFwiZGV0ZWN0cyB5YXJuIGZyb20gbG9ja2ZpbGUgaW4gcGFyZW50IGRpciAyXCIsICgpID0+IHtcbiAgICBjb25zdCBmaWxlcyA9IGNvbW1vbkZpbGVzKClcbiAgICBmaWxlcy53b3Jrc3BhY2VzLndvcmtzcGFjZVtcInlhcm4ubG9ja1wiXSA9IFwiXCIgLy8gZW1wdHkgZmlsZSBpcyBvayBmb3Igbm93XG4gICAgbW9ja0ZzKGZpbGVzKVxuICAgIGV4cGVjdChkZXRlY3RQYWNrYWdlTWFuYWdlcihwcm9qZWN0UGF0aCwgbnVsbCkpLnRvQmUoXCJ5YXJuXCIpXG4gIH0pXG5cbiAgaXQoXCJkZXRlY3RzIHBucG0gZnJvbSBsb2NrZmlsZSBpbiBjd2RcIiwgKCkgPT4ge1xuICAgIGNvbnN0IGZpbGVzID0gY29tbW9uRmlsZXMoKVxuICAgIGZpbGVzLndvcmtzcGFjZXMud29ya3NwYWNlLnByb2plY3RzLnByb2plY3RbXCJwbnBtLWxvY2sueWFtbFwiXSA9IFwiXCIgLy8gZW1wdHkgZmlsZSBpcyBvayBmb3Igbm93XG4gICAgbW9ja0ZzKGZpbGVzKVxuICAgIGV4cGVjdChkZXRlY3RQYWNrYWdlTWFuYWdlcihwcm9qZWN0UGF0aCwgbnVsbCkpLnRvQmUoXCJwbnBtXCIpXG4gIH0pXG5cbiAgaXQoXCJkZXRlY3RzIHBucG0gZnJvbSBsb2NrZmlsZSBpbiBwYXJlbnQgZGlyXCIsICgpID0+IHtcbiAgICBjb25zdCBmaWxlcyA9IGNvbW1vbkZpbGVzKClcbiAgICBmaWxlcy53b3Jrc3BhY2VzLndvcmtzcGFjZS5wcm9qZWN0c1tcInBucG0tbG9jay55YW1sXCJdID0gXCJcIiAvLyBlbXB0eSBmaWxlIGlzIG9rIGZvciBub3dcbiAgICBtb2NrRnMoZmlsZXMpXG4gICAgZXhwZWN0KGRldGVjdFBhY2thZ2VNYW5hZ2VyKHByb2plY3RQYXRoLCBudWxsKSkudG9CZShcInBucG1cIilcbiAgfSlcblxuICBpdChcImRldGVjdHMgcG5wbSBmcm9tIGxvY2tmaWxlIGluIHBhcmVudCBkaXIgMlwiLCAoKSA9PiB7XG4gICAgY29uc3QgZmlsZXMgPSBjb21tb25GaWxlcygpXG4gICAgZmlsZXMud29ya3NwYWNlcy53b3Jrc3BhY2VbXCJwbnBtLWxvY2sueWFtbFwiXSA9IFwiXCIgLy8gZW1wdHkgZmlsZSBpcyBvayBmb3Igbm93XG4gICAgbW9ja0ZzKGZpbGVzKVxuICAgIGV4cGVjdChkZXRlY3RQYWNrYWdlTWFuYWdlcihwcm9qZWN0UGF0aCwgbnVsbCkpLnRvQmUoXCJwbnBtXCIpXG4gIH0pXG5cbiAgLy8gRklYTUVcbiAgLypcbiAgaXQoXCJmYWxscyBiYWNrIHRvIG5wbSBpZiBubyBsb2NrZmlsZSB3YXMgZm91bmRcIiwgKCkgPT4ge1xuICAgIGNvbnN0IGZpbGVzID0gY29tbW9uRmlsZXMoKVxuICAgIG1vY2tGcyhmaWxlcylcbiAgICBleHBlY3QoZGV0ZWN0UGFja2FnZU1hbmFnZXIocHJvamVjdFBhdGgsIG51bGwpKS50b0JlKFwibnBtXCIpXG4gICAgbW9ja0ZzLnJlc3RvcmUoKVxuICB9KVxuICAqL1xuXG4gIC8vIFRPRE8gdGVzdCBvdmVycmlkZVBhY2thZ2VNYW5hZ2VyICE9IG51bGxcblxuICBhZnRlckVhY2goKCkgPT4ge1xuICAgIG1vY2tGcy5yZXN0b3JlKClcbiAgfSlcbiAgLy9hZnRlckFsbCgoKSA9PiB7XG4gIC8vICBtb2NrRnMucmVzdG9yZSgpXG4gIC8vfSlcbn0pXG4iXX0=